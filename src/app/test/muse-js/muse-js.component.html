<!-- *********************************** -->
<!-- Búsqueda y Conexión del Dispositivo -->
<!-- *********************************** -->
<div *ngIf="!startTesting">
    <div class="card bg-white rounded-4 shadow" style="height: 30rem;">
        <div class="card-body d-flex align-items-center justify-content-center">
            <div class="row">
                <div class="col">
                    <div *ngIf="lookingDevice" class="row text-center myTransition my-5">
                        <span class="looking"></span>
                        <span class="text-info fs-8 mt-3">Buscando...</span>
                    </div>
                    <div *ngIf="showTest"
                        class="row text-center myTransition my-5 d-flex justify-content-center align-items-center">
                        <div class="success-icon">
                            <div class="success-icon__tip"></div>
                            <div class="success-icon__long"></div>
                        </div>
                        <span class="text-success fs-8 mt-3">¡Conexión exitosa!</span>
                        <span class="mt-3 fw-bolder fs-4">
                            Comenzando prueba, espere...
                        </span>
                    </div>
                    <div class="row text-center" *ngIf="!lookingDevice && !showTest">
                        <div class="col">
                            <div class="row">
                                <span class="mb-3 fw-bolder fs-5">
                                    Por favor, encienda el bluetooth (<i class="fab fa-bluetooth"></i>) en ambos
                                    dispositivos (<i class="fas fa-laptop"></i> - <i class="fas fa-code-branch"></i>)
                                    para iniciar la búsqueda.
                                </span>
                            </div>
                            <div class="row mb-2">
                                <div class="col">
                                    <button class="btn btn-rounded btn-raised btn-info fs-5"
                                        (click)="connectToDevice()">
                                        <i class="fab fa-bluetooth me-2"></i>Conectar Dispositivo
                                    </button>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <button class="btn btn-outline-primary btn-rounded btn-raised fs-4 border-2"
                                        (click)="cancel()">
                                        <i class="fas fa-external-link-alt me-2"></i>Ir al Perfil del Paciente
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- *********************************** -->
<!-- Prueba en Tiempo Real -->
<!-- *********************************** -->
<div [hidden]="!startTesting">
    <div class="card-body bg-white rounded-4 shadow px-2 py-3 mb-4">
        <div class="row">
            <div class="col-12 col-md-2 mb-2 mb-md-0 justify-content-center align-items-center">
                <div class="d-flex justify-content-start align-items-center bg-dark rounded-5 py-2 ps-3 ms-2 fs-4">
                    <div class="recording-circle me-2"></div>
                    <div class="text-white">Grabando...</div>
                </div>
            </div>
            <div class="col-12 col-md-10 d-flex justify-content-center justify-content-md-end align-items-center">
                <div class="button-group gap-2">
                    <button type="button" class="btn btn-rounded btn-raised btn-danger mb-0 fs-4"
                        (click)="openStop(content2)">
                        <i class="fas fa-stop-circle me-2"></i>Cancelar
                    </button>
                    <button type="button" class="btn btn-rounded btn-raised btn-info mb-0 fs-4"
                        (click)="openPause(content)">
                        <i class="fas fa-pause-circle me-2"></i>Pausar
                    </button>
                    <button type="button" class="btn btn-rounded btn-raised btn-success mb-0 fs-4"
                        (click)="openFinish(content3)">
                        <i class="fas fa-check-circle me-2"></i>Finalizar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="row d-flex align-items-center justify-content-center mt-2">
        <!-- Detalles del paciente -->
        <div class="col-12 col-md-4">
            <div class="card shadow bg-white text-dark rounded-4">
                <div class="card-header text-center rounded-4 rounded-bottom">
                    <h5 class="card-title mb-0">Información del paciente</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col fs-4">
                            <div class="d-flex justify-content-between">
                                <span class="fw-bolder">Nombre: </span>
                                <span>{{ current_patient.nombre }}</span>
                            </div>
                            <hr>
                            <div class="d-flex justify-content-between">
                                <span class="fw-bolder">Edad: </span>
                                <span>{{ current_patient.edad }} años</span>
                            </div>
                            <hr>
                            <div class="d-flex justify-content-between">
                                <span class="fw-bolder">Diagnóstico previo: </span>
                                <span>Ninguno</span>
                            </div>
                            <hr>
                            <div class="d-flex justify-content-between">
                                <span class="fw-bolder">Consumo de medicamentos: </span>
                                <span>No</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Detalles de la prueba -->
        <div class="col-12 col-md-4">
            <div class="card shadow bg-white text-dark rounded-4">
                <div class="card-header text-center rounded-4 rounded-bottom">
                    <h5 class="card-title mb-0">Detalles de la prueba</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col fs-4">
                            <div class="d-flex justify-content-between">
                                <span class="fw-bolder">ID Prueba: </span>
                                <span>{{ test_id }}</span>
                            </div>
                            <hr>
                            <div class="d-flex justify-content-between">
                                <span class="fw-bolder">Fecha: </span>
                                <span>{{ fechaHoy }}</span>
                            </div>
                            <hr>
                            <div class="d-flex justify-content-between">
                                <span class="fw-bolder">Hora Inicio: </span>
                                <span>{{ tHora + ' Hrs' }}</span>
                            </div>
                            <hr>
                            <div class="d-flex justify-content-between">
                                <span class="fw-bolder">Tiempo Transcurrido: </span>
                                <span>{{ tiempo }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Detalles del dispositivo -->
        <div class="col-12 col-md-4">
            <div class="card shadow bg-white text-dark rounded-4">
                <div class="card-header text-center rounded-4 rounded-bottom">
                    <h5 class="card-title mb-0">Información del dispositivo</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col fs-4">
                            <div class="d-flex justify-content-between">
                                <span class="fw-bolder">Nombre: </span>
                                <span>{{ dName }}</span>
                            </div>
                            <hr>
                            <div class="d-flex justify-content-between">
                                <span class="fw-bolder">Firmware: </span>
                                <span>{{ dFirw }}</span>
                            </div>
                            <hr>
                            <div class="d-flex justify-content-between">
                                <span class="fw-bolder">Batería: </span>
                                <span>{{ dBatt ? dBatt + ' %' : '---'}}</span>
                            </div>
                            <hr>
                            <div class="d-flex justify-content-between">
                                <span class="fw-bolder">Estado: </span>
                                <span class="rounded-4 text-white px-2"
                                    [ngClass]="{'bg-danger': !dConn, 'bg-success': dConn}">
                                    {{ dConn ? 'Conectado' : 'Desconectado' }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row d-flex align-items-center justify-content-center mt-2">
        <div class=" col-12 col-md-12 col-lg-8">
            <div class="card shadow bg-white text-dark rounded-4">
                <div class="card-header text-center rounded-4 rounded-bottom">
                    <h5 class="card-title mb-0">Información EEG</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col">
                            <canvas #myChart id="myChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class=" col-12 col-md-12 col-lg-4">
            <div class="card shadow bg-white text-dark rounded-4">
                <div class="card-header text-center rounded-4 rounded-bottom">
                    <h5 class="card-title mb-0">Actividad Física</h5>
                </div>
                <div class="card-body fs-4">
                    <div class="row">
                        <div class="col">
                            <div class="">
                                <span class="fw-bolder">Nivel de Actividad Física Observada: </span><br>
                                <form action="">
                                    <select class="form-select mt-3 bg-white" name="selectForm" required 
                                        [(ngModel)]="formPrev.nivelActFisicaObservada">
                                        <option value="" disabled>Elegir...</option>
                                        <option value="1">Alta</option>
                                        <option value="2">Moderada</option>
                                        <option value="3">Baja</option>
                                    </select>
                                </form>
                            <hr>
                            <div class="">
                                <span class="fw-bolder">Nivel de Atención Onservado: </span>
                                <br>
                                <form action="">
                                    <select class="form-select mt-3 bg-white" name="selectForm" required
                                        [(ngModel)]="formPrev.nivelAteObservada">
                                        <option value="" disabled>Elegir...</option>
                                        <option value="1">Atento</option>
                                        <option value="2">Medianamente Atento</option>
                                        <option value="3">Inatento</option>
                                    </select>
                                </form>
                            </div>
                            <hr>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="d-flex justify-content-center align-items-center">
                                <app-head-view [xyz]="accelerometer"></app-head-view>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col px-0">
            <div class="card shadow rounded-4 bg-white">
                <div class="card-header rounded-4 rounded-bottom">
                    <h5 class="card-title mb-0">Observaciones</h5>
                </div>
                <div class="card-body">
                    <!-- <app-editor [readOnly]="readOnly" [contenidoGuardado]="contenidoDelEditor" (contenidoCambiado)="actualizarContenido($event)"></app-editor> -->
                    <app-editor [readOnly]="readOnly" (contenidoCambiado)="actualizarContenido($event)"></app-editor>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- PAUSE Start -->
<ng-template #content let-c="close" let-d="dismiss">
    <div class="modal-header bg-info bg-opacity-100 text-white">
        <h4 class="modal-title" id="modal-basic-title">Prueba en pausa</h4>
    </div>
    <div class="modal-body p-2 justify-content-center text-center bg-white">
        <span class="loader5"></span>
        <p class="fw-bolder fs-5">En pausa...</p>
    </div>
    <div class="modal-footer justify-content-center bg-white">
        <button type="button" class="btn btn-rounded btn-raised btn-light-info border border-info border-1 text-info font-medium fs-4"
            (click)="c('Save click'); resumeTest()">Reanudar</button>
    </div>
</ng-template>
<!-- PAUSE End -->

<!-- CANCEL Start -->
<ng-template #content2 let-c="close" let-d="dismiss">
    <div class="modal-header bg-danger bg-opacity-100 text-white">
        <h4 class="modal-title" id="modal-basic-title">Cancelar Prueba</h4>
        <!-- <button type="button" class="btn-close" aria-label="Close" (click)="d('Cross click')"></button> -->
    </div>
    <div class="modal-body fs-4 p-3 justify-content-center text-center bg-white">
        <p class="fs-5 fw-bold">¿Desea cancelar la prueba?</p>
        <span class="fs-4">Todos los datos recopilados se perderán</span>
    </div>
    <div class="modal-footer justify-content-center bg-white">
        <button type="button" class="btn btn-rounded btn-raised btn-light-success border border-success border-1 text-success font-medium fs-4"
            (click)="c('Save click')">No, Reanudar</button>
        <button type="button" class="btn btn-rounded btn-raised btn-light-danger border border-danger border-1 text-danger font-medium fs-4"
            (click)="cancelTest()">Sí, Cancelar</button>
    </div>
</ng-template>
<!-- CANCEL End -->

<!-- FINISH Start -->
<ng-template #content3 let-c="close" let-d="dismiss">
    <div class="modal-header bg-success bg-opacity-100 text-white">
        <h4 class="modal-title" id="modal-basic-title">Finalizar Prueba</h4>
        <!-- <button type="button" class="btn-close" aria-label="Close" (click)="d('Cross click')"></button> -->
    </div>
    <div class="modal-body fs-4 p-3 justify-content-center text-center bg-white">
        <p class="fs-5 fw-bold">¿Desea finalizar la prueba?</p>
        <span class="fs-4">Antes de finalizar, asegúrese de cumplir con el tiempo mínimo para la precisión de los
            datos</span>
    </div>
    <div class="modal-footer justify-content-center bg-white">
        <button type="button" class="btn btn-rounded btn-raised btn-light-info border border-info border-1 text-info font-medium fs-4"
            (click)="c('Save click')">Reanudar</button>
        <button type="button" class="btn btn-rounded btn-raised btn-light-success border border-success border-1 text-success font-medium fs-4"
            (click)="open5(content5)">Finalizar</button>
    </div>
</ng-template>
<!-- FINISH End -->

<!-- Form Prediagnóstico Start -->
<ng-template #content5 let-c="close" let-d="dismiss">
    <div class="modal-header bg-success bg-opacity-100 text-white">
        <h4 class="modal-title" id="modal-basic-title">Prediagnóstico</h4>
        <!-- <button type="button" class="btn-close" aria-label="Close" (click)="d('Cross click')"></button> -->
    </div>
    <div class="modal-body fs-5 p-3 justify-content-center text-center bg-white">
        <div class="form-group mb-4">
            <span class="">
                ¿Considera que el paciente es diagnósticado con alguna de las siguietes condiciones relacionados con
                el TDAH?
            </span>
            <label class="mr-sm-2" for="selectForm">Por favor, seleccione la opción más cercana a su criterio</label>
            <select class="form-select" id="selectForm" name="selectTDAH" [(ngModel)]="formPred.prediagnostico">
                <option value="" selected disabled>Elegir...</option>
                <option value="0">NO presenta TDAH</option>
                <option value="1">TDAH Predominantemente Inatento</option>
                <option value="2">TDAH Predominantemente Hiperactivo</option>
                <option value="3">TDAH Mixto</option>
            </select>
        </div>
        <div class="form-group mb-2">
            <label class="mr-sm-2" for="selectForm">Justifique su respuesta a continuación</label>
            <textarea class="form-control bg-white" cols="30" rows="6" name="justificacion" [(ngModel)]="formPred.justificacion"></textarea>
        </div>
    </div>
    <div class="modal-footer justify-content-center bg-white">
        <button type="button" class="btn btn-rounded btn-raised btn-light-success border border-success border-1 text-success font-medium fs-4"
            (click)="openSave(content4)">Guardar Prueba</button>
    </div>
</ng-template>
<!-- Form Prediagnóstico End -->

<!-- Mi modal Start -->
<ng-template #content4 let-c="close" let-d="dismiss">
    <div class="modal-body">
        <div class="row p-5 justify-content-center text-center bg-white">
            <span class="loader6"></span>
            <span class="mt-5 font-medium fs-6">Guardando datos...</span>
        </div>
    </div>
</ng-template>
<!-- Mi modal End -->